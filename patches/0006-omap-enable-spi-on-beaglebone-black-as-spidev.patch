From d4b4461716c501a5c965079b409178ac4fc5c3f4 Mon Sep 17 00:00:00 2001
From: Alexander Couzens <lynxis@fe80.eu>
Date: Sun, 29 Mar 2015 00:07:51 +0100
Subject: [PATCH 6/9] omap: enable spi on beaglebone black as spidev

---
 .../patches-4.4/999-enable-spi0-as-spidev.patch   | 35 ++++++++++++++++++++++
 1 file changed, 35 insertions(+)
 create mode 100644 target/linux/omap/patches-4.4/999-enable-spi0-as-spidev.patch

Index: openwrt/target/linux/omap/patches-4.4/999-enable-spi0-as-spidev.patch
===================================================================
--- /dev/null	1970-01-01 00:00:00.000000000 +0000
+++ openwrt/target/linux/omap/patches-4.4/999-enable-spi0-as-spidev.patch	2016-04-30 19:19:32.442941570 +0200
@@ -0,0 +1,34 @@
+Index: linux-4.4.7/arch/arm/boot/dts/am335x-boneblack.dts
+===================================================================
+--- linux-4.4.7.orig/arch/arm/boot/dts/am335x-boneblack.dts	2016-04-30 18:43:29.499494884 +0200
++++ linux-4.4.7/arch/arm/boot/dts/am335x-boneblack.dts	2016-04-30 19:03:02.455055740 +0200
+@@ -64,6 +64,14 @@
+ 			0x1b0 0x03      /* xdma_event_intr0, OMAP_MUX_MODE3 | AM33XX_PIN_OUTPUT */
+ 		>;
+ 	};
++	spi0_pins: pinmux_spi0_pins {
++		pinctrl-single,pins = <
++			0x150 (PIN_INPUT_PULLUP | MUX_MODE0)    /* spi0_sclk */
++			0x154 (PIN_INPUT_PULLUP | MUX_MODE0)    /* spi0_d0 */
++			0x158 (PIN_OUTPUT_PULLUP | MUX_MODE0)   /* spi0_d1 */
++			0x15c (PIN_OUTPUT_PULLUP | MUX_MODE0)   /* spi0_cs0 */
++		>;
++	};
+ };
+ 
+ &lcdc {
+@@ -94,3 +102,14 @@
+ &rtc {
+ 	system-power-controller;
+ };
++
++&spi0 {
++  status = "okay";
++  pinctrl-names = "default";
++  pinctrl-0 = <&spi0_pins>;
++  spidev@0 {
++    spi-max-frequency = <24000000>;
++    reg = <0>;
++    compatible = "spidev";
++  };
++};
